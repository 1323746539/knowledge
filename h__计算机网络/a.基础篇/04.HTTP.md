### 一、概述

- HTTP 是超文本传输协议，是应用层协议，默认端口号 80

- 使用 TCP 作为传输协议，保证了数据传输的可靠性

### 二、优缺点

- 优点

    - 支持客户端/服务端模式

    - 简单快速：HTTP 协议简单，相应的服务器程序规模小，通信速度快

    - 无连接：限制每次链接只处理一次请求，服务器处理完客户的请求，并收到客户的应答后，即断开连接

    - 无状态：HTTP 协议是无状态协议，不记录关于客户的任何信息

    - 灵活：允许传输任意类型的数据对象

- 缺点：

    - 无状态：不记录先前信息，意味着如果后续需要前面的信息，则它必须重传

    - 明文传输：协议中的报文使用的是文本形式，不加密，存在被窃听的风险

    - 不安全：不验证通信方的身份，因此可能遭遇伪装

### 三、连接模式

- HTTP 协议有两种连接模式，一种是持续连接，另一种是非持续连接

    - 非持续连接： 服务器必须为每一个请求的对象建立和维护一个全新的连接

    - 持续连接：TCP 连接默认不关闭，多次请求可以使用同一个 TCP 连接，减少三次握手次数

### 四、协议版本

#### 4.1 HTTP 1.1

- 默认使用持续连接（长连接）

- 引入管道机制，即同一个 TCP 连接，客户端可以同时发送多个请求，但是服务器必须按照发送顺序返回响应

- 加入新的请求方法：PUT、DELETE、PATCH、HEAD、OPTIONS

- 加入新的缓存机制：强缓存和协商缓存

- 请求头加入 **Host** 字段，用来指定服务器域名

- 存在问题： 

    - 队头阻塞： 同一个 TCP 连接，前一个请求的响应没有返回，后面的请求只能阻塞等待

#### 4.2 HTTP 2.0

- 二进制协议：HTTP 1.1 版本的报文是文本格式，HTTP 2.0 版本的报文是二进制格式，统称为帧，分为头帧和数据帧。是实现多路复用的基础

- 多路复用：可以同时发送多个请求和接收响应，且不需要考虑顺序问题，解决对头阻塞问题

- 头部信息压缩：头信息使用 gzip 或 compress 压缩后再发送

    - 客户端和服务器同时维护一份头信息表，所有字段都会存入这个表，生成一个索引号，以后就不发送同样字段了，只发送索引号，这样就提高传输速度

- 服务器推送：服务器可以主动向客户端推送资源，无需客户端请求

- 存在问题：

    - 由于多个数据流使用同一个 TCP 连接，遵守同一个流量状态控制和拥塞控制。只要一个数据流遭遇到拥塞，剩下的数据流就没法发出去，这样就导致了后面的所有数据都会被阻塞

    - 原因是其使用的 TCP 协议的问题

#### 4.3 HTTP 3.0

- 基于UDP协议实现了类似于TCP的多路复用数据流、传输可靠性等功能，这套功能被称为QUIC协议

- 优点

    - 流量控制、传输可靠性

    - 集成 TLS 加密功能，减少握手次数

    - 多路复用，解决队头阻塞问题

    - 快速握手，基于 UDP，快速建立连接

### 五、强缓存与协商缓存

- 强缓存：浏览器直接读取本地缓存，不向服务器发送请求

    - 实现方式：Expires、Cache-Control

        - `Expires: Wed, 21 Oct 2025 07:28:00 GMT` ，判断缓存是否过期，缺点依赖客户端时间，可能不准

        - `Cache-Control`

            - max-age=3600：资源有效期为3600秒（优先级高于Expires）

            - no-cache：禁用强缓存，转为协商缓存

            - no-store：完全禁止缓存（包括协商缓存）

            - public/private：指定资源是否可被代理服务器或仅浏览器缓存

- 协商缓存：浏览器向服务器验证资源是否变更，未变更则返回 304 ，继续使用缓存，变更则返回 200，重新获取资源

    - 实现方式：`Last-Modified + If-Modified-Since`、`ETag + If-None-Match（优先级更高）`

        - `Last-Modified`：服务器响应请求时，返回资源的最后修改时间

        - `ETag` ：服务器响应请求时，返回资源的唯一标识（hash值）

        - `If-Modified-Since` 和 `If-None-Match` 都是后续请求时带上发给服务器做对比判断资源是否变更

### 六、请求报文与响应报文

- 请求报文组成

    - 请求行：请求方法、请求 URI、HTTP 版本

    - 请求头：请求头字段、请求头字段值

    - 空行：由一个回车符和一个换行符组成

    - 请求体：请求报文的主体内容

- 响应报文组成

    - 状态行：HTTP 版本、状态码、状态码描述

    - 响应头：响应头字段、响应头字段值

    - 空行：由一个回车符和一个换行符组成

    - 响应体：响应报文的主体内容

### 七、常见请求方法

- GET: 向服务器获取数据

- POST：将实体提交到指定的资源，通常会造成服务器资源的修改。

- PUT：上传文件，修改数据

- DELETE：删除服务器上的对象

- HEAD：获取报文首部，与GET相比，不返回报文主体部分

- OPTIONS：询问支持的请求方法，用来跨域请求

- TRACE：追踪 请求—响应 的传输路径

- CONNECT：要求在与代理服务器通信时建立隧道，使用隧道进行TCP通信

### 八、常见请求头/响应头字段

#### 8.1 通用标头

 - Date：可以出现在请求标头和响应标头中，表示的是格林威治标准时间

 - Cache-Control：可以出现在请求标头和响应标头中，控制缓存的行为

 - Connection：决定当前的事物完成后是否关闭网络连接。持久连接：keep-alive。 非持久连接：close

#### 8.2 实体标头：描述消息正文内容的HTTP标头

| Content-Encoding | 实体主体适应的编码方式 | Content-Language | 实体主体的自然语言 |
|--|--|--|--|
| Content-Length | 实体主体的大小（字节） | Content-Location | 替代对应资源的URL  |
| Content-Range | 实体主体的位置范围 | Content-Type | 实体主体的媒体类型 |

#### 8.3 请求标头

| User-Agent | HTTP客户端程序的信息 | Referer | 对请求中URL的原始获取方 |
|--|--|--|--|
| If-Modified-Since | 比较更新时间 | Host | 请求资源服务器 |
| Accept | 用户代理可以处理的媒体类型 | Accept-Charset | 优先的字符集 |
| Accept-Encoding | 优先的内容编码 | Accept-Language | 优先的语言 |

#### 8.4 响应标头

 - Keep-Alive：设置超时时长和最大请求数，需要将 Connection 首部的值设置为 "keep-alive" 这个首部才有意义

 - Set-Cookie：用于服务器向客户端发送 sessionID

 - Location：令客户端重定向至指定URL

### 九、状态码

#### 9.1 分类

| 分类 | 定义 | 描述 |
|--|--|--|
| 1xx | 信息性状态码 | 请求已接收，正在处理 |
| 2xx | 成功状态码 | 请求正常处理完毕 |
| 3xx | 重定向状态码 | 需要进行附加操作以完成请求 |
| 4xx | 客户端错误状态码 | 服务器无法处理请求 |
| 5xx | 服务器错误状态码 | 服务器处理请求出错 |

#### 9.2 常见状态码

| 状态码 | 描述 |
|--|--|
| 200 | 请求成功 |
| 204 | 请求成功，但响应报文不含实体的主体部分，即没有返回内容 |
| 301 | 永久重定向 |
| 302 | 临时重定向 |
| 304 | 资源未修改，可使用缓存 |
| 400 | 请求错误，一般是请求格式错误、无效参数、请求头问题、请求体过大 |
| 401 | 未通过 HTTP 认证 |
| 403 | 禁止访问，一般是服务器知道客户端的身份，但客户端没有访问权限被拒绝 |
| 404 | 资源未找到 |
| 500 | 服务器内部错误 |
| 502 | 服务器作为网关或代理，从上游服务器收到无效响应 |
| 503 | 服务器暂时处于超负载或正在进行停机维护，现在无法处理请求 |