
### 一、基本理解

- `$nextTick` 是Vue提供的一个异步方法，用于在DOM更新完成后执行回调函数。它的核心作用是确保代码在Vue完成DOM更新后执行
- 主要特点：
  - 异步执行：将回调延迟到下次DOM更新循环之后执行
  - 微任务机制：在大多数现代浏览器中基于 Promise 实现
  - 兼容性处理：在不支持 Promise 的旧浏览器中，会使用 setTimeout 模拟实现
- 应用场景：
  - 当需要在DOM更新后获取最新的DOM元素状态时
  - 在created生命周期中操作DOM


### 二、实现原理

- 核心机制：
  - Vue 在观察到数据变化时，不会立即更新 DOM
  - 而是开启一个队列，并缓冲在同一事件循环中发生的所有数据变更
  - 如果同一个 watcher 被多次触发，只会被推入到队列中一次
  - 然后，在下一个的事件循环“tick”中，Vue 刷新队列并执行实际 (已去重的) 工作

- 原理：
  - 首先，`$nextTick` 会根据环境（是否支持 Promise）选择合适的方式来实现异步执行
  - 在支持 Promise 的环境中，会使用 `Promise.resolve().then(callback)` 来将回调函数添加到微任务队列中
  - 在不支持 Promise 的环境中，会使用 `setTimeout(callback, 0)` 来将回调函数添加到宏任务队列中


### 三、常见面试题延伸

- 1、为什么需要使用 `$nextTick`？
  - Vue 在数据更新后，DOM 并不会立即更新，DOM 更新是异步的，需要一种机制来确保在 DOM 更新完成后执行特定的代码

- 2、与 `setTimeout` 有什么区别？
  -  `$nextTick` 优先使用微任务，执行时机更早

- 3、多个 `$nextTick` 会如何执行？
  - 多个 `$nextTick` 会被合并成一个任务，确保在同一个事件循环中只执行一次

