
### 一、XSS

#### 1.1 概念

- XSS 攻击指的是跨站脚本攻击，是一种代码注入攻击
- 本质是因为网站没有对恶意代码进行过滤，与正常的代码混合在一起了，浏览器没有办法分辨哪些脚本是可信的，从而导致了恶意代码的执行
- 这种攻击可以通过恶意脚本，实现以下功能：
  - 窃取用户的信息，如 cookie、localStorage 等
  - 破坏页面的结构，如修改 DOM 节点
  - DOS攻击，发送合理请求，占用服务器资源，从而使用户无法访问服务器
  - 流量劫持（将链接指向某网站）

#### 1.2 分类

- 存储型 XSS
  - 存储型 XSS 攻击是指将恶意代码存储到服务器的数据库中，然后当用户请求数据时，恶意代码就会被执行
  - 常见于论坛、评论、博客等网站
- 反射型 XSS 
  - 反射型 XSS 攻击是指将恶意代码存储在 URL 中，诱导用户点击链接，从而执行恶意代码
- DOM 型 XSS
  - DOM 型 XSS 攻击是指将恶意代码存储在 DOM 节点中
  - 常见于富文本编辑器、富文本展示等场景

#### 1.3 防御

- 对用户输入的数据或插入 HTML 中的代码进行过滤和转义
- 使用 HttpOnly 标记 cookie，防止 XSS 攻击窃取 cookie
- 使用 CSP（内容安全策略），本质是建立一个白名单，告诉浏览器哪些外部资源可以加载和执行，从而防止恶意代码的注入攻击




### 二、CSRF

#### 2.1 概念

- CSRF 攻击指的是跨站请求伪造攻击，是一种利用用户的登录状态进行的攻击
- 攻击者诱导用户进入一个第三方网站，然后该网站向被攻击网站发送跨站请求。如果用户在被攻击网站中保存了登录状态，那么攻击者就可以利用这个登录状态，绕过后台的用户验证，冒充用户向服务器执行一些操作
- 本质是利用了 cookie 会在同源请求中携带发送给服务器的特点，以此来实现用户的冒充

#### 2.2 分类

- GET 类型的 CSRF 攻击，比如在网站中的一个 img 标签里构建一个请求，当用户打开这个网站的时候就会自动发起提交
- POST 类型的 CSRF 攻击，比如说构建一个表单，然后隐藏它，当用户进入页面时，自动提交这个表单
- 链接类型的 CSRF 攻击，比如说在 a 标签的 href 属性里构建一个请求，然后诱导用户去点击

#### 2.3 防御

- 验证 HTTP Referer 或 origin 字段，判断请求是否来自合法的域名
  - 但是 referer 可以被伪造 
  - 这种方法同时把搜索引擎的链接也给屏蔽了
- 在请求中添加 token，服务器验证 token 是否有效
  - 缺点是需要在每个请求中添加 token，增加了请求的复杂度
- 使用 SameSite 属性，设置 cookie 的 SameSite 属性为 Strict 或 Lax，限制 cookie 不能作为被第三方使用，从而防止 CSRF 攻击
- 使用双重 Cookie 验证的办法
  - 服务器在用户访问网站页面时，向请求域名注入一个Cookie，内容为随机字符串，然后当用户再次向服务器发送请求的时候，从 cookie 中取出这个字符串，添加到 URL 参数中，然后服务器通过对 cookie 中的数据和参数中的数据进行比较，来进行验证。使用这种方式是利用了攻击者只能利用 cookie，但是不能访问获取 cookie 的特点。
- 使用验证码，防止脚本冒充用户提交请求


